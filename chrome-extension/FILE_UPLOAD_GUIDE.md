# 文件上传功能使用指南

## 📋 概述

43X Agent Tester 支持两种类型的文件上传：
1. **场景配置文件** (.json) - 定义测试场景的参数
2. **项目资料文件** (.pdf, .docx, .doc, .md, .txt) - 提供给 Agent 的背景资料

---

## 📄 场景配置文件上传

### 支持格式
- `.json` 格式

### 文件大小限制
- 最大 1MB

### 必填字段
```json
{
  "scenario_name": "场景名称（必填）",
  "company_name": "公司名称（必填）"
}
```

### 可选字段
```json
{
  "industry": "行业分类",
  "product": "产品描述",
  "revenue": "营收情况",
  "team": "团队信息",
  "funding_need": "融资需求",
  "expected_result": "预期结果 (passed/rejected/pending)",
  "project_details": {
    // 任意 JSON 对象，包含详细项目信息
  }
}
```

### 上传步骤
1. 点击 "上传配置 (.json)" 按钮
2. 选择 JSON 配置文件
3. 系统自动验证文件格式和必填字段
4. 验证通过后显示在文件列表中
5. 自动保存到"最近使用"列表

### 验证规则
- ✅ 文件必须是有效的 JSON 格式
- ✅ 必须包含 `scenario_name` 和 `company_name` 字段
- ✅ 字段值必须是非空字符串
- ✅ 文件大小不超过 1MB

### 错误处理
- **JSON 格式错误**: 提示 "JSON 格式错误，请检查文件格式是否正确"
- **缺少必填字段**: 提示 "配置文件缺少必填字段: xxx"
- **字段类型错误**: 提示具体的字段类型要求
- **文件过大**: 提示 "配置文件过大（最大 1MB）"

### 覆盖行为
- 如果已有配置文件，上传新文件时会提示是否覆盖
- 选择"确定"将替换当前配置
- 选择"取消"将保留当前配置

---

## 📁 项目资料文件上传

### 支持格式
- `.pdf` - PDF 文档
- `.docx` / `.doc` - Word 文档
- `.md` - Markdown 文档
- `.txt` - 纯文本文档

### 文件大小限制
- 单个文件最大 10MB

### 上传步骤
1. 点击 "上传资料 (.pdf/.docx/.md/.txt)" 按钮
2. 选择一个或多个文件（支持多选）
3. 系统自动读取文件内容
4. 验证通过后显示在文件列表中

### 文件处理
- **文本文件** (.md, .txt): 直接读取为文本
- **二进制文件** (.pdf, .docx, .doc): 读取为 Base64 编码

### 多文件上传
- 支持一次选择多个文件
- 每个文件独立验证和处理
- 显示上传结果摘要（成功 X 个，失败 Y 个）

### 覆盖行为
- 如果上传同名文件，会提示是否覆盖
- 选择"确定"将替换已有文件
- 选择"取消"将跳过该文件

### 错误处理
- **不支持的文件类型**: 提示 "不支持的文件类型: .xxx"
- **文件过大**: 提示 "文件过大（最大 10MB）"
- **读取失败**: 提示具体的错误信息

---

## 📋 文件列表管理

### 文件显示
每个文件在列表中显示：
- **图标**: 根据文件类型显示不同图标
  - ⚙️ 配置文件 (.json)
  - 📕 PDF 文档 (.pdf)
  - 📘 Word 文档 (.docx, .doc)
  - 📝 Markdown (.md)
  - 📄 文本文件 (.txt)
- **文件名**: 完整文件名（鼠标悬停显示完整路径）
- **文件大小**: 自动格式化（B / KB / MB）
- **删除按钮**: ✕ 按钮删除文件

### 文件排序
- 配置文件始终显示在最前面
- 其他文件按上传顺序排列

### 删除文件
1. 点击文件右侧的 ✕ 按钮
2. 确认删除提示
3. 文件从列表和内存中移除
4. 显示删除成功提示

### 清空列表
- 删除配置文件会禁用"开始测试"按钮
- 删除所有文件后列表为空

---

## 🔄 最近使用场景

### 自动保存
- 每次上传配置文件后自动保存到"最近使用"
- 包含配置内容和所有附加文件
- 记录上传时间戳

### 场景列表
- 下拉菜单显示最近 5 个场景
- 显示格式: `场景名 - 公司名 (X个文件) - 时间`
- 鼠标悬停显示详细信息

### 加载场景
1. 从下拉菜单选择场景
2. 确认加载提示（会覆盖当前配置）
3. 自动加载配置和所有文件
4. 显示在文件列表中

### 时间显示
- 刚刚
- X分钟前
- X小时前
- X天前
- 具体日期（超过7天）

---

## 💡 使用技巧

### 1. 快速测试
- 使用"下载示例"功能获取示例配置
- 直接上传示例文件开始测试

### 2. 批量上传
- 一次选择多个资料文件
- 系统自动处理所有文件

### 3. 场景复用
- 常用场景会自动保存
- 从"最近使用"快速加载

### 4. 文件管理
- 及时删除不需要的文件
- 保持文件列表整洁

### 5. 错误排查
- 查看控制台日志（F12）
- 检查文件格式和大小
- 验证 JSON 语法

---

## 🔧 高级功能

### 文件内容格式

#### 配置文件示例
```json
{
  "scenario_name": "ai_saas_example",
  "company_name": "智语科技",
  "industry": "AI 客服 SaaS",
  "product": "基于大模型的智能客服系统",
  "revenue": "ARR 500万人民币",
  "team": "15人，核心团队来自阿里、腾讯",
  "funding_need": "A轮 2000万人民币",
  "expected_result": "passed",
  "project_details": {
    "customers": ["阿里巴巴", "腾讯", "字节跳动"],
    "technology": {
      "model": "GPT-4",
      "accuracy": "95%",
      "response_time": "2秒"
    },
    "financials": {
      "mrr": "42万",
      "growth_rate": "30% MoM",
      "churn_rate": "5%"
    }
  }
}
```

#### 资料文件内容
- **商业计划书** (BP.pdf): 公司和产品介绍
- **财务报表** (财务.xlsx → 导出为 .pdf): 营收和成本数据
- **技术文档** (技术架构.md): 技术栈和架构说明
- **团队介绍** (团队.txt): 核心成员背景

### 文件传输
上传的文件会：
1. 在浏览器内存中保存
2. 通过 Chrome Extension API 传递给 Background Service Worker
3. 通过 HTTP POST 发送给 Python Agent Service
4. Agent Service 解析并使用文件内容

### 数据持久化
- 配置和文件保存在 `chrome.storage.local`
- 浏览器关闭后数据保留
- 最多保存 5 个最近场景
- 每个场景包含完整的配置和文件

---

## 🐛 常见问题

### Q: 为什么上传后没有反应？
A: 检查：
- 文件格式是否正确
- 文件大小是否超限
- 查看控制台错误信息

### Q: 如何上传多个文件？
A: 在文件选择对话框中按住 Ctrl（Windows）或 Cmd（Mac）选择多个文件。

### Q: 配置文件验证失败怎么办？
A: 
- 使用 JSON 验证工具检查格式
- 确保包含必填字段
- 检查字段值类型

### Q: 文件过大怎么办？
A: 
- 压缩文件内容
- 删除不必要的信息
- 分割为多个小文件

### Q: 如何清空所有文件？
A: 逐个点击删除按钮，或重新加载插件。

### Q: 最近使用的场景在哪里？
A: 保存在浏览器本地存储中，可以从下拉菜单访问。

### Q: 如何导出配置？
A: 从"最近使用"加载场景后，可以在日志中查看完整配置。

---

## 🔒 安全说明

### 数据隐私
- 所有文件仅在本地处理
- 不会上传到第三方服务器
- 仅发送到配置的 Agent Service URL

### 文件安全
- 自动进行 HTML 转义防止 XSS
- 文件大小限制防止内存溢出
- 文件类型验证防止恶意文件

### 存储安全
- 使用 Chrome 官方存储 API
- 数据加密存储
- 仅插件可访问

---

## 📚 相关文档

- [FEATURES.md](./FEATURES.md) - 完整功能说明
- [README.md](./README.md) - 插件总体介绍
- [设计文档](../.kiro/specs/43x-agent-rpa-testing/design.md) - 系统架构
